===========================================
デプロイ必要ファイル一覧（2025年1月19日）
===========================================

【修正ファイル（全4ファイル）】

1. metaApi.js
2. dynamicAlertGenerator.js  
3. views/alerts.ejs
4. utils/multiUserChatworkSender.js

===========================================
【各ファイルの修正内容】
===========================================

1. metaApi.js
-----------
■ 新規追加: fetchMetaDataWithStoredConfig関数（576-614行目）
  - ユーザー設定を使用してMeta APIからデータを取得
  - userIdベースでユーザー固有のデータを取得
■ 修正: fetchMetaAdDailyStats関数（395-404行目）
  - app_idパラメータをオプショナルに変更
■ module.exportsにfetchMetaDataWithStoredConfigを追加

2. dynamicAlertGenerator.js
-------------------------
■ formatValue関数の修正（42-66行目）
  - CTR: 小数点第1位まで表示（例: 0.9%）
  - 予算消化率: 整数表示（例: 62%）
  - CPM/CPA/CPC: 整数でカンマ区切り（例: 1,927円）
■ generateDynamicAlerts関数の修正（202-219行目）
  - 保存値は元の値のまま保持
  - 表示時のみフォーマット適用
■ saveAlertsToHistory関数（403-447行目）
  - アラート履歴の自動保存機能

3. views/alerts.ejs
------------------
■ formatMetricValue関数の修正（533-555行目）
  - CTR/CVR: 小数点第1位まで表示
  - 予算消化率: 整数表示  
  - CPA/CPM/CPC: 整数でカンマ区切り

4. utils/multiUserChatworkSender.js
-----------------------------------
■ formatValue関数の修正（156-178行目）
  - CTR/CVR: 小数点第1位まで
  - 予算消化率: 整数表示
  - CPA/CPM/CPC: 整数でカンマ区切り
■ 日次レポートメッセージの修正（66-78行目）
  - 予算消化率を整数表示

===========================================
【実装により解決された問題】
===========================================

✅ Meta APIから実際のデータを取得（ランダム値の廃止）
✅ 数値フォーマットの適切化：
  - CTR: 0.899888% → 0.9%
  - CPM: 1926.884円 → 1,927円  
  - 予算消化率: 62.178% → 62%
✅ 保存値は元の精度を保持（表示時のみ丸め処理）
✅ すべての表示箇所で統一フォーマット：
  - アラート内容
  - アラート履歴
  - 確認事項
  - ダッシュボード内アラート
  - Chatwork通知

===========================================
【デプロイ手順】
===========================================

1. 上記4ファイルを本番サーバーにアップロード
2. Node.jsアプリケーションを再起動
3. 動作確認：
   - ダッシュボードでMeta APIデータ表示を確認
   - アラート生成と数値フォーマットを確認
   - Chatwork通知の送信テスト

===========================================
【注意事項】
===========================================

- alert_history.jsonファイルの書き込み権限を確認
- ユーザー設定ファイル（data/user_settings/）は既存のものを使用
- Meta APIアクセストークンの有効性を確認

===========================================