===========================================
デプロイ必要ファイル一覧（2025年1月20日）
===========================================

【今回修正したファイル（全2ファイル）】

1. utils/multiUserChatworkSender.js
2. dynamicAlertGenerator.js

===========================================
【各ファイルの修正内容詳細】
===========================================

1. utils/multiUserChatworkSender.js
-----------------------------------
■ アラート重複排除機能を追加（156-173行目）
  - 各メトリックの最新1件のみを取得
  - 68件の重複アラート → 4件のユニークアラートに削減
  
■ ソート処理を修正（219-226行目）
  - 重複排除後のアラートを重要度順にソート
  - メトリック順の優先順位を追加（CV > CTR > CPM > CPA > 予算消化率）
  
■ URLを本番環境に変更（242-245行目）
  - localhost:3000 → meta-ads-dashboard.onrender.com
  - HTTPからHTTPSに変更

2. dynamicAlertGenerator.js
---------------------------
■ saveAlertsToHistory関数を改善（409-486行目）
  - 24時間以上前のアクティブアラートを自動的に解決済みに変更
  - 新規アラート生成時、同じメトリックの古いアラートを解決
  - 30日以上前のアラートを自動削除
  
■ module.exportsにsaveAlertsToHistoryを追加（491行目）
  - 他のモジュールから関数を利用可能に

===========================================
【実装による改善効果】
===========================================

【改善前】
```
🔴 CV: 目標 1件 → 実績 0件
🔴 CV: 目標 1件 → 実績 0件
🔴 CV: 目標 1件 → 実績 0件
🔴 CV: 目標 1件 → 実績 0件
🔴 CTR: 目標 1% → 実績 0.5%
🔴 CTR: 目標 1% → 実績 0.5%
🔴 CTR: 目標 1% → 実績 0.5%
...他7件のアラート
```

【改善後】
```
🔴 CV: 目標 1件 → 実績 0件
🔴 CTR: 目標 1% → 実績 0.6%
🔴 予算消化率: 目標 80% → 実績 52%
⚠️ CPM: 目標 1,800円 → 実績 2,188円
```

===========================================
【デプロイ手順】
===========================================

1. 以下2つのファイルを本番サーバーにアップロード：
   - utils/multiUserChatworkSender.js
   - dynamicAlertGenerator.js

2. Node.jsアプリケーションを再起動

3. 動作確認：
   - Chatwork通知テストを実行
   - アラートの重複が解消されているか確認
   - URLが正しく本番環境を指しているか確認

===========================================
【注意事項】
===========================================

- 前回デプロイした4ファイルと合わせて、計6ファイルの修正が完了
- alert_history.jsonは自動的にクリーンアップされます
- 古いアラートは24時間後に自動的に解決済みになります

===========================================
【前回デプロイファイル（参考）】
===========================================

1. metaApi.js - Meta APIデータ取得機能
2. views/alerts.ejs - 表示フォーマット統一
3. （既に上記2ファイルでカバー済み）

===========================================