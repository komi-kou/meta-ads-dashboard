<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚¢ãƒ©ãƒ¼ãƒˆå±¥æ­´ - Metaåºƒå‘Šãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</title>
    <link rel="stylesheet" href="/style.css">
    <style>
        .alert-history-page {
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .page-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .page-header h2 {
            margin: 0 0 10px 0;
            font-size: 2.2em;
            font-weight: 700;
        }

        .header-info {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .history-section {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        }

        .history-section h3 {
            margin: 0 0 25px 0;
            color: #333;
            font-size: 1.5em;
            border-bottom: 2px solid #f0f0f0;
            padding-bottom: 15px;
        }

        .no-history {
            text-align: center;
            padding: 60px 20px;
            color: #666;
        }

        .no-history-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 16px;
        }

        .no-history-icon {
            font-size: 48px;
            opacity: 0.6;
        }

        .no-history p {
            font-size: 1.2em;
            margin: 0;
        }

        .history-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .history-item {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            border-left: 4px solid #007bff;
            transition: all 0.3s ease;
        }

        .history-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
        }

        .alert-info {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 10px;
        }

        .alert-level {
            font-size: 1.2em;
            min-width: 30px;
        }

        .alert-level-high {
            color: #dc3545;
        }

        .alert-level-medium {
            color: #ffc107;
        }

        .alert-level-low {
            color: #28a745;
        }

        .alert-metric {
            background: #e9ecef;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 600;
            color: #495057;
        }

        .alert-message {
            flex: 1;
            font-weight: 500;
            color: #333;
        }

        .alert-timestamp {
            color: #6c757d;
            font-size: 0.9em;
            text-align: right;
        }

        @media (max-width: 768px) {
            .alert-history-page {
                padding: 15px;
            }

            .page-header {
                padding: 20px;
            }

            .page-header h2 {
                font-size: 1.8em;
            }

            .history-section {
                padding: 20px;
            }

            .alert-info {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }

            .alert-timestamp {
                text-align: left;
                margin-top: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- ã‚µã‚¤ãƒ‰ãƒãƒ¼ï¼ˆãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã¨å®Œå…¨çµ±ä¸€ï¼‰ -->
        <div class="sidebar">
            <div class="sidebar-header">
                <h3>Metaåºƒå‘Šãƒ¬ãƒãƒ¼ãƒˆ</h3>
            </div>
            <nav class="sidebar-nav">
                <a href="/dashboard" class="nav-item">ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</a>
                <a href="/alerts" class="nav-item">ã‚¢ãƒ©ãƒ¼ãƒˆå†…å®¹</a>
                <a href="/alert-history" class="nav-item active">ã‚¢ãƒ©ãƒ¼ãƒˆå±¥æ­´</a>
                <a href="/improvement-tasks" class="nav-item">ç¢ºèªäº‹é …</a>
                <a href="/improvement-strategies" class="nav-item">æ”¹å–„æ–½ç­–</a>
                <a href="/chatwork-test" class="nav-item">ãƒãƒ£ãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒ†ã‚¹ãƒˆ</a>
            </nav>
        </div>

        <main class="main-content">

    <div class="alert-history-page">
        <div class="page-header">
            <h2>ğŸ“‹ ã‚¢ãƒ©ãƒ¼ãƒˆå±¥æ­´</h2>
            <div class="header-info">
                éå»30æ—¥é–“ã®å±¥æ­´
            </div>
        </div>

        <div class="history-section">
            <h3>éå»30æ—¥é–“ã®ã‚¢ãƒ©ãƒ¼ãƒˆå±¥æ­´</h3>
            
            <div id="history-content">
                <div class="loading">èª­ã¿è¾¼ã¿ä¸­...</div>
            </div>
        </div>
        </main>
    </div>

    <script>
        // ã‚¢ãƒ©ãƒ¼ãƒˆå±¥æ­´ã‚’å–å¾—ã—ã¦è¡¨ç¤º
        async function loadAlertHistory() {
            try {
                console.log('=== ã‚¢ãƒ©ãƒ¼ãƒˆå±¥æ­´ãƒšãƒ¼ã‚¸: ãƒ‡ãƒ¼ã‚¿å–å¾—é–‹å§‹ ===');
                
                // ã‚µãƒ¼ãƒãƒ¼ã®APIã‹ã‚‰å®Ÿéš›ã®ã‚¢ãƒ©ãƒ¼ãƒˆå±¥æ­´ã‚’å–å¾—
                const response = await fetch('/api/alert-history');
                const apiData = await response.json();
                
                console.log('APIãƒ¬ã‚¹ãƒãƒ³ã‚¹:', apiData);
                console.log('success:', apiData.success);
                console.log('history:', apiData.history);
                console.log('history length:', apiData.history ? apiData.history.length : 'undefined');
                
                let filteredHistory = [];
                
                if (apiData.success && apiData.history) {
                    filteredHistory = apiData.history;
                    console.log('âœ… APIã‹ã‚‰å±¥æ­´ãƒ‡ãƒ¼ã‚¿å–å¾—:', filteredHistory.length + 'ä»¶');
                } else if (Array.isArray(apiData)) {
                    filteredHistory = apiData;
                    console.log('âœ… é…åˆ—å½¢å¼ã§ãƒ‡ãƒ¼ã‚¿å–å¾—:', filteredHistory.length + 'ä»¶');
                } else {
                    console.log('âŒ APIã‹ã‚‰ã®ãƒ‡ãƒ¼ã‚¿å–å¾—å¤±æ•—ã€ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯');
                    // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯: ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰èª­ã¿è¾¼ã¿
                    const stored = localStorage.getItem('alert_history');
                    let history = stored ? JSON.parse(stored) : [];
                    
                    // éå»30æ—¥åˆ†ã®ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
                    const thirtyDaysAgo = new Date();
                    thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
                    
                    filteredHistory = history.filter(item => 
                        new Date(item.timestamp) > thirtyDaysAgo
                    );
                    console.log('ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰å–å¾—:', filteredHistory.length + 'ä»¶');
                }
                
                console.log('æœ€çµ‚çš„ãªè¡¨ç¤ºå¯¾è±¡:', filteredHistory);
                
                const historyContent = document.getElementById('history-content');
                
                if (filteredHistory.length === 0) {
                    historyContent.innerHTML = `
                        <div class="no-history">
                            <div class="no-history-content">
                                <span class="no-history-icon">ğŸ“‹</span>
                                <p>ã‚¢ãƒ©ãƒ¼ãƒˆå±¥æ­´ã¯ã‚ã‚Šã¾ã›ã‚“</p>
                            </div>
                        </div>
                    `;
                    return;
                }

                const historyList = filteredHistory.map(alert => {
                    const levelClass = getLevelClass(alert.level);
                    const levelIcon = getLevelIcon(alert.level);
                    const formattedDate = formatDate(alert.timestamp);
                    
                    return `
                        <div class="history-item">
                            <div class="alert-info">
                                <span class="alert-level ${levelClass}">
                                    ${levelIcon}
                                </span>
                                <span class="alert-metric">${alert.metric || 'ä¸æ˜'}</span>
                                <span class="alert-message">${alert.message || 'ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãªã—'}</span>
                            </div>
                            <div class="alert-timestamp">
                                ${formattedDate}
                            </div>
                        </div>
                    `;
                }).join('');

                historyContent.innerHTML = `
                    <div class="history-list">
                        ${historyList}
                    </div>
                `;
            } catch (error) {
                console.error('ã‚¢ãƒ©ãƒ¼ãƒˆå±¥æ­´ã®å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
                document.getElementById('history-content').innerHTML = `
                    <div class="no-history">
                        <div class="no-history-content">
                            <span class="no-history-icon">âŒ</span>
                            <p>ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ</p>
                        </div>
                    </div>
                `;
            }
        }

        function getLevelClass(level) {
            switch(level) {
                case 'high': return 'alert-level-high';
                case 'medium': return 'alert-level-medium';
                case 'low': return 'alert-level-low';
                default: return 'alert-level-medium';
            }
        }

        function getLevelIcon(level) {
            switch(level) {
                case 'high': return 'ğŸ”´';
                case 'medium': return 'ğŸŸ¡';
                case 'low': return 'ğŸŸ¢';
                default: return 'ğŸŸ¡';
            }
        }

        function formatDate(timestamp) {
            return new Date(timestamp).toLocaleString('ja-JP');
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«å±¥æ­´ã‚’å–å¾—
        document.addEventListener('DOMContentLoaded', loadAlertHistory);
    </script>
</body>
</html> 